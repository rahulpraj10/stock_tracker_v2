{% extends "base.html" %}

{% block content %}
<style>
    .strategies-container {
        display: flex;
        gap: 24px;
        min-height: 60vh;
    }

    .strategy-sidebar {
        flex: 0 0 250px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .strategy-tab {
        padding: 12px 16px;
        text-align: left;
        background: transparent;
        border: 1px solid transparent;
        border-radius: 8px;
        cursor: pointer;
        font-size: 13px;
        /* Slightly larger than base for readability */
        color: var(--text-secondary);
        transition: all 0.2s;
        font-weight: 500;
    }

    .strategy-tab:hover {
        background-color: #f3f4f6;
        color: var(--text-main);
    }

    .strategy-tab.active {
        background-color: white;
        color: var(--primary-color);
        border-color: var(--border-color);
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    }

    .strategy-content-area {
        flex: 1;
        background: var(--card-bg);
        border-radius: 12px;
        border: 1px solid var(--border-color);
        padding: 24px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .strategy-pane {
        display: none;
    }

    .strategy-pane.active {
        display: block;
        animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(5px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .strategies-container {
            flex-direction: column;
        }

        .strategy-sidebar {
            flex: none;
            overflow-x: auto;
            flex-direction: row;
            padding-bottom: 8px;
        }

        .strategy-tab {
            white-space: nowrap;
        }
    }
</style>

<div class="strategies-container">
    <div class="strategy-sidebar">
        <button class="strategy-tab active" onclick="openStrategy(event, 'double-bottom')">Double Bottom
            Indicator</button>
        <button class="strategy-tab" onclick="openStrategy(event, 'bullish-reversal')">Bullish Reversal</button>
        <button class="strategy-tab" onclick="openStrategy(event, 'multi-frame')">Multiple Frame growing</button>
        <button class="strategy-tab" onclick="openStrategy(event, 'min-5-day')">Minimum 5 day increase</button>
        <button class="strategy-tab" onclick="openStrategy(event, 'strategy-5')">Strategy 5</button>
    </div>

    <div class="strategy-content-area">
        <div id="double-bottom" class="strategy-pane active">
            <h2>Double Bottom Indicator</h2>
            <p style="color: var(--text-secondary);">Strategy logic and results for Double Bottom Indicator will appear
                here.</p>
        </div>

        <div id="bullish-reversal" class="strategy-pane">
            <h2>Bullish Reversal</h2>
            <p style="color: var(--text-secondary);">Strategy logic and results for Bullish Reversal will appear here.
            </p>
        </div>

        <div id="multi-frame" class="strategy-pane">
            <h2>Multiple Frame growing</h2>
            <p style="color: var(--text-secondary);">Strategy logic and results for Multiple Frame growing will appear
                here.</p>
        </div>

        <div id="min-5-day" class="strategy-pane">
            <h2>Minimum N Day Increase</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Identify stocks that have seen a consecutive increase in daily volume for the last specified number of
                days.
            </p>

            <form method="GET" action="{{ url_for('strategies') }}" class="filter-form"
                style="margin-bottom: 24px; align-items: end;">
                <input type="hidden" name="strategy" value="min_increase">

                <div class="form-group">
                    <label for="days">Consecutive Days (N)</label>
                    <input type="number" id="days" name="days" value="{{ days|default(5) }}" min="2" max="10" required
                        style="width: 100px;">
                </div>

                <button type="submit" class="btn btn-primary" onclick="openStrategy(event, 'min-5-day')">Apply
                    Strategy</button>
            </form>

            {% if strategy == 'min_increase' %}
            {% if results %}
            <div style="margin-bottom: 16px; font-weight: 500;">
                Found {{ results|length }} stocks with strictly increasing volume for last {{ days }} days.
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>SC_CODE</th>
                            <th>Stock Name</th>
                            <th>Recent Volumes (Oldest &rarr; Newest)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stock in results %}
                        <tr>
                            <td>{{ stock.SC_CODE }}</td>
                            <td>{{ stock.SC_NAME }}</td>
                            <td style="font-family: monospace;">{{ stock.Volumes | join(' &rarr; ') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <p>No stocks found matching the criteria for {{ days }} consecutive days of volume increase.</p>
            </div>
            {% endif %}
            {% endif %}
        </div>

        <div id="strategy-5" class="strategy-pane">
            <h2>Strategy 5</h2>
            <p style="color: var(--text-secondary);">Strategy logic and results for Strategy 5 will appear here.</p>
        </div>
    </div>
</div>

<script>
    function openStrategy(evt, strategyName) {
        var i, tabcontent, tablinks;

        // Hide all content panes
        tabcontent = document.getElementsByClassName("strategy-pane");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].classList.remove("active");
        }

        // Deactivate all tab links
        tablinks = document.getElementsByClassName("strategy-tab");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(strategyName).classList.add("active");

        // Find the button that targets this strategy and make it active
        for (i = 0; i < tablinks.length; i++) {
            if (tablinks[i].getAttribute('onclick').includes("'" + strategyName + "'")) {
                tablinks[i].classList.add("active");
            }
        }
    }

    // Auto-open tab based on server state or URL param
    window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const strategy = urlParams.get('strategy');

        if (strategy === 'min_increase') {
            openStrategy({ currentTarget: document.querySelector("button[onclick*='min-5-day']") }, 'min-5-day');
        }
        // Add more conditions here as we implement other strategies
    };
</script>
{% endblock %}